# 액션: 에이전트가 환경과 상호작용하도록 하기

<Tip>
이 섹션에서는 AI 에이전트가 환경과 상호작용하기 위해 취하는 구체적인 단계들을 살펴봅니다.

액션이 어떻게 표현되는지(JSON 또는 코드 사용), 중지 및 구문 분석 접근법의 중요성, 그리고 다양한 유형의 에이전트를 소개할 것입니다.
</Tip>

액션은 **AI 에이전트가 환경과 상호작용하기 위해 취하는** 구체적인 단계입니다.

정보를 검색하거나 물리적 장치를 제어하는 것이든, 각 액션은 에이전트가 실행하는 의도적인 작업입니다.

예를 들어, 고객 서비스를 지원하는 에이전트는 고객 데이터를 검색하고, 지원 문서를 제공하거나, 문제를 인간 담당자에게 이관할 수 있습니다.

## 에이전트 액션의 유형

액션을 다르게 취하는 여러 유형의 에이전트가 있습니다:

| 에이전트 유형 | 설명 |
|--------------|------|
| JSON 에이전트 | 취할 액션이 JSON 형식으로 지정됩니다. |
| 코드 에이전트 | 에이전트가 외부에서 해석되는 코드 블록을 작성합니다. |
| 함수 호출 에이전트 | JSON 에이전트의 하위 범주로, 각 액션에 대해 새로운 메시지를 생성하도록 미세 조정되었습니다. |

액션 자체는 다양한 목적을 수행할 수 있습니다:

| 액션 유형 | 설명 |
|-----------|------|
| 정보 수집 | 웹 검색 수행, 데이터베이스 쿼리, 문서 검색 |
| 도구 사용 | API 호출, 계산 실행, 코드 실행 |
| 환경 상호작용 | 디지털 인터페이스 조작 또는 물리적 장치 제어 |
| 통신 | 채팅을 통한 사용자와의 소통 또는 다른 에이전트와의 협업 |

LLM은 텍스트만 처리하며 이를 사용하여 취하고자 하는 액션과 도구에 제공할 매개변수를 설명합니다. 에이전트가 제대로 작동하려면, LLM은 완전한 액션을 정의하는 모든 토큰을 출력한 후 새로운 토큰 생성을 중지해야 합니다. 이는 제어를 LLM에서 에이전트로 다시 넘기고 결과가 구문 분석 가능하도록 보장합니다 - 의도된 형식이 JSON이든, 코드이든, 함수 호출이든 상관없이 말입니다.

## 중지 및 구문 분석 접근법

액션을 구현하는 핵심 방법 중 하나는 **중지 및 구문 분석 접근법**입니다. 이 방법은 에이전트의 출력이 구조화되고 예측 가능하도록 보장합니다:

1. **구조화된 형식으로 생성**:

에이전트는 의도한 액션을 명확하고 미리 정의된 형식(JSON 또는 코드)으로 출력합니다.

2. **추가 생성 중지**:

액션을 정의하는 텍스트가 출력되면, **LLM은 추가 토큰 생성을 중지**합니다. 이는 추가적이거나 잘못된 출력을 방지합니다.

3. **출력 구문 분석**:

외부 파서가 형식화된 액션을 읽고, 어떤 도구를 호출할지 결정하며, 필요한 매개변수를 추출합니다.

예를 들어, 날씨를 확인해야 하는 에이전트는 다음과 같이 출력할 수 있습니다:

```json
Thought: 뉴욕의 현재 날씨를 확인해야 합니다.
Action :
{
  "action": "get_weather",
  "action_input": {"location": "New York"}
}
```
그러면 프레임워크는 호출할 함수의 이름과 적용할 인수를 쉽게 구문 분석할 수 있습니다.

이러한 명확하고 기계가 읽을 수 있는 형식은 오류를 최소화하고 외부 도구가 에이전트의 명령을 정확하게 처리할 수 있게 합니다.

참고: 함수 호출 에이전트는 지정된 함수가 올바른 인수와 함께 호출되도록 각 액션을 구조화하여 유사하게 작동합니다.
이러한 유형의 에이전트에 대해서는 향후 유닛에서 더 자세히 다룰 것입니다.

## 코드 에이전트

대안적인 접근법은 *코드 에이전트*를 사용하는 것입니다.
아이디어는 다음과 같습니다: **단순한 JSON 객체를 출력하는 대신**, 코드 에이전트는 **실행 가능한 코드 블록—일반적으로 Python과 같은 고수준 언어로—**을 생성합니다.

<img src="https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/unit1/code-vs-json-actions.png" alt="코드 에이전트" />

이 접근법은 여러 가지 장점을 제공합니다:

- **표현력:** 코드는 루프, 조건문, 중첩 함수를 포함한 복잡한 로직을 자연스럽게 표현할 수 있어 JSON보다 더 큰 유연성을 제공합니다.
- **모듈성과 재사용성:** 생성된 코드는 다른 액션이나 작업에서 재사용할 수 있는 함수와 모듈을 포함할 수 있습니다.
- **향상된 디버깅 가능성:** 잘 정의된 프로그래밍 구문을 사용하므로, 코드 오류를 감지하고 수정하기가 더 쉽습니다.
- **직접 통합:** 코드 에이전트는 외부 라이브러리와 API를 직접 통합할 수 있어 데이터 처리나 실시간 의사결정과 같은 더 복잡한 작업이 가능합니다.

LLM이 생성한 코드를 실행하는 것은 프롬프트 주입부터 유해한 코드 실행까지 보안 위험을 초래할 수 있다는 점을 명심해야 합니다.
그래서 기본적인 보호 장치가 통합된 `smolagents`와 같은 AI 에이전트 프레임워크를 사용하는 것이 권장됩니다.
위험과 이를 완화하는 방법에 대해 더 알고 싶다면, [이 전용 섹션을 참조하세요](https://huggingface.co/docs/smolagents/tutorials/secure_code_execution).

예를 들어, 날씨를 가져오는 작업을 맡은 코드 에이전트는 다음과 같은 Python 스니펫을 생성할 수 있습니다:

```python
# 코드 에이전트 예시: 날씨 정보 가져오기
def get_weather(city):
    import requests
    api_url = f"https://api.weather.com/v1/location/{city}?apiKey=YOUR_API_KEY"
    response = requests.get(api_url)
    if response.status_code == 200:
        data = response.json()
        return data.get("weather", "날씨 정보를 찾을 수 없습니다")
    else:
        return "오류: 날씨 데이터를 가져올 수 없습니다."

# 함수를 실행하고 최종 답변 준비
result = get_weather("New York")
final_answer = f"뉴욕의 현재 날씨는: {result}"
print(final_answer)
```

이 예시에서 코드 에이전트는:

- **API 호출**을 통해 날씨 데이터를 가져오고,
- 응답을 처리하며,
- print() 함수를 사용하여 최종 답변을 출력합니다.

이 방법도 코드 블록을 명확하게 구분하고 실행이 완료되었음을 신호하여(여기서는 final_answer를 출력함으로써) **중지 및 구문 분석 접근법을 따릅니다**.

---

우리는 액션이 JSON, 코드 또는 함수 호출을 통해 명확하고 구조화된 작업을 실행함으로써 에이전트의 내부 추론과 실제 세계의 상호작용을 연결한다는 것을 배웠습니다.

이러한 의도적인 실행은 중지 및 구문 분석 접근법을 통해 각 액션이 정확하고 외부 처리가 가능하도록 보장합니다. 다음 섹션에서는 관찰을 살펴보면서 에이전트가 환경으로부터의 피드백을 어떻게 캡처하고 통합하는지 알아볼 것입니다.

이후에는 **드디어 우리의 첫 번째 에이전트를 만들 준비가 될 것입니다!**